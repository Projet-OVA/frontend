<div class="reports-page">
  <div class="toolbar card">
    <div class="left">
      <select [(ngModel)]="reportType" (change)="load()">
        <option value="users">Utilisateurs</option>
        <option value="contents">Contenus & Activités</option>
      </select>

      <input type="date" [(ngModel)]="from" />
      <span>au</span>
      <input type="date" [(ngModel)]="to" />
      <button class="btn btn-primary" (click)="load()">Actualiser</button>
    </div>

    <div class="right">
      <button class="btn" (click)="export('csv')">Exporter CSV</button>
      <button class="btn" (click)="export('xlsx')">Exporter Excel</button>
      <button class="btn btn-primary" (click)="print()">Imprimer</button>
    </div>
  </div>

  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>Chargement des données...</p>
  </div>

  <div *ngIf="!loading && dashboardData" class="grid-two">
    <div class="card">
      <h3>Rapport: {{ reportType === 'users' ? 'Utilisateurs' : 'Contenus & Activités' }}</h3>
      <table class="table">
        <thead>
          <tr>
            <th>Indicateur</th>
            <th>Valeur</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let r of reports">
            <td>{{ r.title }}</td>
            <td><strong>{{ r.value }}</strong></td>
            <td>
              <button class="btn-ghost" (click)="export('csv')">
                Exporter
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="card">
      <h3>Visualisation des données</h3>
      <div class="chart-container">
        <canvas #chartCanvas id="chart-report" width="400" height="300"></canvas>
      </div>
    </div>
  </div>

  <div *ngIf="!loading && !dashboardData" class="error-message">
    <h3>❌ Erreur de chargement des données</h3>
    <p>Impossible de charger les données du dashboard. Veuillez réessayer.</p>
  </div>
</div>