<div class="courses-page">
  <!-- Toolbar -->
  <div class="toolbar card">
    <div class="left">
      <button class="btn btn-primary" (click)="openCourseDialog()">+ Nouveau cours</button>
    </div>
  </div>

  <!-- Courses table -->
  <div class="card">
    <table class="table" role="table" aria-label="Liste des cours">
      <thead>
        <tr>
          <th>Nom</th>
          <th>Cat√©gorie</th>
          <th>Description</th>
          <th>Quiz</th>
          <th style="width: 200px">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr 
          *ngFor="let c of courses" 
          [hidden]="filterStatus && c.status !== filterStatus"
          (click)="openDetailsDialog(c)"
          class="clickable-row"
        >
          <td>{{ c.nom }}</td>
          <td>{{ c.category }}</td>
          <td class="desc">{{ c.description }}</td>
          <td>
            <ul class="quiz-list" *ngIf="c.quizzes?.length; else noQuiz">
              <li *ngFor="let q of c.quizzes">{{ q.nom }} ({{ q.score }}%)</li>
            </ul>
            <ng-template #noQuiz>
              <span class="muted">Aucun</span>
            </ng-template>
          </td>
          <td>
            <button class="btn-ghost" title="√âditer" (click)="openCourseDialog(c); $event.stopPropagation()">‚úèÔ∏è</button>
            <button class="btn-danger" title="Supprimer" (click)="delete(c); $event.stopPropagation()">üóëÔ∏è</button>
            <button class="btn btn-secondary" title="Ajouter quiz" (click)="openQuizDialog(c); $event.stopPropagation()">‚ûï Quiz</button>
          </td>
        </tr>
        <tr *ngIf="!courses?.length">
          <td colspan="5" class="muted">Aucun cours trouv√©</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Modal cours -->
  <div class="dialog" *ngIf="showCourseDialog">
    <div class="dialog-content">
      <h3>{{ newCourse?.id ? 'Modifier' : 'Cr√©er' }} cours</h3>
      <input type="text" placeholder="Nom*" [(ngModel)]="newCourse.nom" />
      <select [(ngModel)]="newCourse.category">
        <option value="">Choisir une cat√©gorie</option>
        <option value="ENVIRONNEMENT">Environnement</option>
        <option value="DROIT_DU_CITOYEN">Droit du citoyen</option>
        <option value="DEVOIR_DU_CITOYEN">Devoir du citoyen</option>
      </select>
      <textarea placeholder="Description" [(ngModel)]="newCourse.description"></textarea>
      <div class="actions">
        <button class="btn" (click)="showCourseDialog=false" type="button">Annuler</button>
        <button class="btn btn-primary" (click)="saveCourse()" [disabled]="savingCourse">
          {{ savingCourse ? 'Enregistrement...' : 'Enregistrer' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Modal quiz -->
  <div class="dialog" *ngIf="showQuizDialog">
    <div class="dialog-content">
      <h3>Cr√©er un quiz pour : {{ selectedCourse?.nom }}</h3>
      <input type="text" placeholder="Nom*" [(ngModel)]="newQuiz.nom" />
      <textarea placeholder="Description" [(ngModel)]="newQuiz.description"></textarea>
      <input type="number" placeholder="Score max" [(ngModel)]="newQuiz.score" />

      <div class="questions">
        <div *ngFor="let q of newQuiz.questions; let i=index" class="question-block">
          <input type="text" placeholder="Question" [(ngModel)]="q.content" />
          <div *ngFor="let opt of q.options; let j=index" class="option-block">
            <input type="text" placeholder="Option" [(ngModel)]="opt.content" />
            <label>
              Correct
              <input type="checkbox" [(ngModel)]="opt.isCorrect" />
            </label>
          </div>
          <button class="btn btn-sm" (click)="addOption(i)">Ajouter option</button>
        </div>
      </div>
      <button class="btn btn-sm" (click)="addQuestion()">Ajouter question</button>

      <div class="actions">
        <button class="btn" (click)="showQuizDialog=false" type="button">Annuler</button>
        <button class="btn btn-primary" (click)="saveQuiz()" [disabled]="savingQuiz">
          {{ savingQuiz ? 'Enregistrement...' : 'Enregistrer quiz' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Modal d√©tails cours -->
  <div class="dialog" *ngIf="showDetailsDialog">
    <div class="dialog-content details">
      <h3>D√©tails du cours</h3>

      <p><strong>Nom :</strong> {{ selectedCourseDetails?.nom }}</p>
      <p><strong>Cat√©gorie :</strong> {{ selectedCourseDetails?.category }}</p>
      <p><strong>Description :</strong> {{ selectedCourseDetails?.description }}</p>

      <div *ngIf="selectedCourseDetails?.quizzes?.length">
        <h4>üìö Quizzes associ√©s</h4>
        <ul>
          <li *ngFor="let q of selectedCourseDetails.quizzes">
            {{ q.nom }} ‚Äî <em>{{ q.score }}%</em>
          </li>
        </ul>
      </div>

      <div *ngIf="!selectedCourseDetails?.quizzes?.length">
        <p class="muted">Aucun quiz pour ce cours.</p>
      </div>

      <div class="actions">
        <button class="btn" (click)="closeDetailsDialog()">Fermer</button>
      </div>
    </div>
  </div>
</div>
