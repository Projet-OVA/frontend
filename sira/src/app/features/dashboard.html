<div class="dashboard-page">
  <div class="page-header">
    <h1>Tableau de bord</h1>
    <p>Vue d'ensemble de la plateforme SIRA</p>
  </div>

  <div *ngIf="loading" class="loading">Chargement des données...</div>

  <div *ngIf="error" class="error-card card">
    <h3>❌ Erreur</h3>
    <p>{{ error }}</p>
    <button class="btn btn-primary" (click)="loadDashboardData()">Réessayer</button>
  </div>

  <!-- UTILISEZ dashboardData AU LIEU DE stats -->
  <div *ngIf="dashboardData && !loading" class="dashboard-grid">
    
    <!-- Statistiques utilisateurs -->
    <div class="card stat-card">
      <div class="stat-icon">👥</div>
      <div class="stat-content">
        <h3>{{ dashboardData.userStats.totalUsers }}</h3>
        <p>Utilisateurs total</p>
        <small>{{ dashboardData.userStats.activeUsers }} actifs</small>
      </div>
    </div>

    <!-- Événements -->
    <div class="card stat-card">
      <div class="stat-icon">🎯</div>
      <div class="stat-content">
        <h3>{{ dashboardData.eventStats.totalEvents }}</h3>
        <p>Événements</p>
      </div>
    </div>

    <!-- Badges -->
    <div class="card stat-card">
      <div class="stat-icon">🏆</div>
      <div class="stat-content">
        <h3>{{ dashboardData.badgeStats.totalBadges }}</h3>
        <p>Badges attribués</p>
      </div>
    </div>

    <!-- Progression cours -->
    <div class="card stat-card">
      <div class="stat-icon">📚</div>
      <div class="stat-content">
        <h3 [style.color]="getProgressColor(parseFloat(dashboardData.courseProgress.completionRate))">
          {{ formatPercentage(dashboardData.courseProgress.completionRate) }}
        </h3>
        <p>Complétion cours</p>
        <small [class.positive]="dashboardData.courseProgress.completionRateChange.includes('+')"
               [class.negative]="dashboardData.courseProgress.completionRateChange.includes('-')">
          {{ dashboardData.courseProgress.completionRateChange }}
        </small>
      </div>
    </div>

    <!-- Engagement communauté -->
    <div class="card stat-card">
      <div class="stat-icon">💬</div>
      <div class="stat-content">
        <h3>{{ formatPercentage(dashboardData.communityEngagement.engagementRate) }}</h3>
        <p>Engagement</p>
        <small [class.positive]="dashboardData.communityEngagement.engagementRateChange.includes('+')"
               [class.negative]="dashboardData.communityEngagement.engagementRateChange.includes('-')">
          {{ dashboardData.communityEngagement.engagementRateChange }}
        </small>
      </div>
    </div>
  </div>

  <!-- Section progression utilisateur -->
  <div *ngIf="userProgress" class="card progress-section">
    <h2>📊 Progression Utilisateur</h2>
    
    <div class="overall-progress">
      <div class="progress-bar">
        <div class="progress-fill" [style.width]="userProgress.data.overallProgress + '%'"></div>
      </div>
      <span class="progress-text">{{ userProgress.data.overallProgress }}% complété</span>
    </div>

    <div class="categories-grid">
      <div *ngFor="let category of userProgress.data.categories" class="category-card">
        <h4>{{ category.category }}</h4>
        <div class="progress-bar small">
          <div class="progress-fill" 
               [style.width]="category.progressPercentage + '%'"
               [style.background]="getProgressColor(category.progressPercentage)"></div>
        </div>
        <p>{{ category.completedQuizzes }}/{{ category.totalQuizzes }} quiz complétés</p>
        <span class="percentage">{{ category.progressPercentage }}%</span>
      </div>
    </div>
  </div>

  <!-- Distribution des badges -->
  <div *ngIf="dashboardData?.badgeStats?.badgeDistribution" class="card">
    <h2>🎖️ Distribution des Badges</h2>
    <div class="badges-distribution">
      <!-- UTILISEZ getBadgeDistribution() méthode -->
      <div *ngFor="let badge of getBadgeDistribution()" class="badge-item">
        <span class="badge-key">{{ badge.key }}</span>
        <span class="badge-count">{{ badge.count }}</span>
      </div>
    </div>
  </div>
</div>