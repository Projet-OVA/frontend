<div class="challenges-page">
  <!-- Header -->
  <div class="page-header">
    <h1>üéØ D√©fis Communautaires</h1>
    <p>G√©rez les propositions d'√©v√©nements de la communaut√©</p>
  </div>

  <!-- Filtres -->
  <div class="filters card">
    <div class="filter-group">
      <label>Statut :</label>
      <select [(ngModel)]="currentFilter" (change)="loadEventProposals()">
        <option value="all">Tous</option>
        <option value="pending">En attente</option>
        <option value="approved">Approuv√©s</option>
        <option value="rejected">Rejet√©s</option>
      </select>
    </div>
    <button class="btn btn-primary" (click)="loadEventProposals()">
      üîÑ Actualiser
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>Chargement des propositions...</p>
  </div>

  <!-- Tableau des propositions -->
  <div *ngIf="!loading" class="card">
    <table class="table">
      <thead>
        <tr class="moins">
          <th>Titre</th>
          <th>Description</th>
          <th>Propos√© par</th>
          <th>Date pr√©vue</th>
          <th>Lieu</th>
          <th>Statut</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let proposal of eventProposals" class="clickable-row">
          <td>{{ proposal.title || 'Sans titre' }}</td>
          <td>{{ truncateText(proposal.description, 50) }}</td>
          <td>{{ proposal.proposedBy?.username || 'Utilisateur' }}</td>
          <td>{{ proposal.proposedDate | date:'shortDate' }}</td>
          <td>{{ proposal.location || 'Non sp√©cifi√©' }}</td>
          <td>
            <span class="status-badge" [class]="'status-' + proposal.status">
              {{ getStatusLabel(proposal.status) }}
            </span>
          </td>
          <td>
            <div class="action-buttons">
              <button class="btn-ghost" (click)="openDetailsDialog(proposal); $event.stopPropagation()">
                üëÅÔ∏è Voir
              </button>
              <button *ngIf="proposal.status === 'PENDING'" 
                      class="btn-success" 
                      (click)="reviewProposal(proposal.id, 'APPROVE'); $event.stopPropagation()">
                ‚úì Approuver
              </button>
              <button *ngIf="proposal.status === 'PENDING'" 
                      class="btn-danger" 
                      (click)="openRejectDialog(proposal); $event.stopPropagation()">
                ‚úó Rejeter
              </button>
            </div>
          </td>
        </tr>

        <tr *ngIf="eventProposals.length === 0">
          <td colspan="7" class="muted">
            Aucune proposition d'√©v√©nement
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Dialog D√©tails -->
  <div *ngIf="showDetailsDialog && selectedProposal" class="dialog">
    <div class="dialog-content">
      <h3>üìã D√©tails de la proposition</h3>
      
      <div class="proposal-details">
        <div class="detail-row">
          <label>Titre :</label>
          <span>{{ selectedProposal.title }}</span>
        </div>
        <div class="detail-row">
          <label>Description :</label>
          <span>{{ selectedProposal.description }}</span>
        </div>
        <div class="detail-row">
          <label>Propos√© par :</label>
          <span>{{ selectedProposal.proposedBy?.username || 'Utilisateur' }} ({{ selectedProposal.proposedBy?.email || 'Email non disponible' }})</span>
        </div>
        <div class="detail-row">
          <label>Date pr√©vue :</label>
          <span>{{ selectedProposal.proposedDate | date:'fullDate' }}</span>
        </div>
        <div class="detail-row">
          <label>Lieu :</label>
          <span>{{ selectedProposal.location || 'Non sp√©cifi√©' }}</span>
        </div>
        <div class="detail-row">
          <label>Statut :</label>
          <span class="status-badge" [class]="'status-' + selectedProposal.status">
            {{ getStatusLabel(selectedProposal.status) }}
          </span>
        </div>
        <div class="detail-row" *ngIf="selectedProposal.comment">
          <label>Commentaire :</label>
          <span>{{ selectedProposal.comment }}</span>
        </div>
      </div>

      <div class="dialog-actions">
        <button class="btn" (click)="closeDetailsDialog()">Fermer</button>
        <button *ngIf="selectedProposal.status === 'PENDING'" 
                class="btn-success" 
                (click)="reviewProposal(selectedProposal.id, 'APPROVE')">
          Approuver
        </button>
        <button *ngIf="selectedProposal.status === 'PENDING'" 
                class="btn-danger" 
                (click)="openRejectDialog(selectedProposal)">
          Rejeter
        </button>
      </div>
    </div>
  </div>

  <!-- Dialog Rejet -->
  <div *ngIf="showRejectDialog" class="dialog">
    <div class="dialog-content">
      <h3>‚úó Rejeter la proposition</h3>
      
      <p>Pourquoi rejetez-vous cette proposition ?</p>
      
      <textarea 
        [(ngModel)]="rejectComment" 
        placeholder="Raison du rejet..."
        rows="4"
      ></textarea>

      <div class="dialog-actions">
        <button class="btn" (click)="closeRejectDialog()">Annuler</button>
        <button class="btn-danger" (click)="confirmReject()" [disabled]="!rejectComment">
          Confirmer le rejet
        </button>
      </div>
    </div>
  </div>
</div>
