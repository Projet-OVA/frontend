<div class="users-page">
  <h2>Liste des citoyens</h2>

  @if (loading) {
    <div class="loading">Chargement...</div>
  }

  @if (!loading && users.length) {
    <table class="table">
      <thead>
        <tr>
          <th>Nom</th>
          <th>Pr√©nom</th>
          <th>Email</th>
          <th>Username</th>
          <th>T√©l√©phone</th>
          <th>Cr√©√© le</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        @for (u of users; track u.id) {
          <tr (click)="openDetails(u)" class="clickable-row">
            <td>{{ u.nom }}</td>
            <td>{{ u.prenom }}</td>
            <td>{{ u.email }}</td>
            <td>{{ u.username }}</td>
            <td>{{ u.phoneNumber || '-' }}</td>
            <td>{{ u.createdAt | date : 'short' }}</td>
            <td>
              <button class="btn-danger" (click)="deleteUser(u); $event.stopPropagation()">üóëÔ∏è</button>
            </td>
          </tr>
        }
      </tbody>
    </table>
  }

  @if (!loading && !users.length) {
    <div class="muted">Aucun citoyen trouv√©</div>
  }

  <!-- Dialog d√©tails user -->
  @if (showDetailsDialog && selectedUser) {
    <div class="dialog">
      <div class="dialog-content">
        <h3>D√©tails utilisateur</h3>
        <p><strong>Nom:</strong> {{ selectedUser.nom }} {{ selectedUser.prenom }}</p>
        <p><strong>Email:</strong> {{ selectedUser.email }}</p>
        <p><strong>Username:</strong> {{ selectedUser.username }}</p>
        <p><strong>T√©l√©phone:</strong> {{ selectedUser.phoneNumber || '-' }}</p>
        <p><strong>Cr√©√© le:</strong> {{ selectedUser.createdAt | date : 'short' }}</p>

        <h4>Badges</h4>
        @if (userBadges.length) {
          <div class="badges-list">
            @for (b of userBadges; track b.id) {
              <div class="badge-card">
                <img [src]="b.icon" [alt]="b.title" class="badge-icon" />
                <div>
                  <strong>{{ b.title }}</strong>
                  <p class="muted">{{ b.description }}</p>
                </div>
              </div>
            }
          </div>
        } @else {
          <p class="muted">Aucun badge</p>
        }

        <div class="actions">
          <button class="btn" (click)="showDetailsDialog = false">Fermer</button>
        </div>
      </div>
    </div>
  }
</div>
